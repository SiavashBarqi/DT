clear 
close all
clc
%%
snr = 20;
% load gong.mat;
load handel.mat;
m_sig = y.';
Fsm = 8192;
Fc = 3*8192;
Fs = 5*Fc;
m_sig_2 = resample(m_sig,Fs/Fsm,1);
l=length(m_sig_2);
t = (0:l-1)/Fs;
figure(1)
plot(t,m_sig_2)
carrier = cos(2*pi*Fc.*t);
am_dsb = m_sig_2.*carrier;
figure(2)
plot(t,am_dsb)
figure(3)
pwelch(m_sig_2,[],[],[],Fs,'centered','power')
figure(4)
pwelch(am_dsb,[],[],[],Fs,'centered','power')

%%
SNR_real = snr-10*log(Fs/Fsm);
y = awgn(am_dsb,SNR_real,'measured');
figure(5)
pwelch(y,[],[],[],Fs,'centered','power')

%% demodulated
y_am_sc_mult = y.*carrier;
pwelch(y_am_sc_mult,[],[],2^12,Fs,'centered','power');

Num_filter = [0.000229319977219214,0.000417187583438901,0.000733729108680069,0.00113296003159713,0.00157604165840992,0.00199287755829262,0.00228236559726997,0.00231820565764080,0.00196185410079670,0.00108195418144867,-0.000421123477188838,-0.00258853020268289,-0.00537708844061330,-0.00863959367106290,-0.0121152389654120,-0.0154334051124041,-0.0181331683318551,-0.0196997042873431,-0.0196133569966869,-0.0174091102355218,-0.0127387094827068,-0.00542774820540972,0.00447897904474536,0.0166929869397510,0.0306813541225436,0.0456945606911131,0.0608194104654162,0.0750548355224524,0.0874011671318396,0.0969549639703171,0.102996920587684,0.105064163426390,0.102996920587684,0.0969549639703171,0.0874011671318396,0.0750548355224524,0.0608194104654162,0.0456945606911131,0.0306813541225436,0.0166929869397510,0.00447897904474536,-0.00542774820540972,-0.0127387094827068,-0.0174091102355218,-0.0196133569966869,-0.0196997042873431,-0.0181331683318551,-0.0154334051124041,-0.0121152389654120,-0.00863959367106290,-0.00537708844061330,-0.00258853020268289,-0.000421123477188838,0.00108195418144867,0.00196185410079670,0.00231820565764080,0.00228236559726997,0.00199287755829262,0.00157604165840992,0.00113296003159713,0.000733729108680069,0.000417187583438901,0.000229319977219214];
am_sc_out = filter(Num_filter,1,y_am_sc_mult);
sig_out = resample(am_sc_out,1,Fs/Fsm);
figure(6)
plot(sig_out)
figure(7)
pwelch(sig_out,[],[],2^12,Fsm,'centered','power');

% sound(m_sig)
sound(sig_out)

