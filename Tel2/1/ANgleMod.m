clear
clc
close all
%% Matlab Example
Fs = 100e3; % Sampling rate of signal
Fc = 8e3; % Carrier frequency
t = [0:Fs-1]'/Fs; % Sampling times
s1 = sin(2*pi*300*t)+0*sin(2*pi*600*t); % Channel 1
s2 = sin(2*pi*150*t)+0*sin(2*pi*900*t); % Channel 2
x = [s1,s2]; % Two-channel signal
dev = 5; % Frequency deviation in modulated signal
y = pmmod(x,Fc,Fs,dev); % Modulate both channels.
figure(10)
pwelch(y(:,1),[],[],[],Fs,'centered','power')
% z = fmdemod(y,Fc,Fs,dev); % Demodulate both channels.
% plot(z);

%% parameters
snr = 10; % SNR in dB
fm = 300; 
fc = Fc;
fs = Fs;
t = [0:fs-1]/fs; %0:1/fs:300/fm; % time vector
m_sig = cos(2*pi*fm.*t);
kp = dev; % PM mod. index
x_pm = cos(2*pi*fc*t+kp*m_sig);
figure(1)
plot(x_pm)
figure(2)
pwelch(m_sig,[],[],[],fs,'centered','power')
figure(3)
pwelch(x_pm,[],[],[],fs,'centered','power')

%% FM demodulation

der_x_pm = filter([1 -1],1,x_pm); % derivation of input signal
figure(4)
pwelch(der_x_pm,[],[],[],fs,'centered','power')
plot(der_x_pm)

%% AM_demo
y_am = der_x_pm.*cos(2*pi*fc*t);
pwelch(y_am,[],[],2^12,fs,'centered','power');
Num_filter = [-6.73258239445068e-05,7.12716703474689e-06,6.90567082957985e-06,6.78233193872101e-06,6.75548742340925e-06,6.81164408343599e-06,6.95114550358716e-06,7.16212748291280e-06,7.44679735310842e-06,7.79489228738381e-06,8.20975196229050e-06,8.68199871150619e-06,9.21608429213179e-06,9.80363095383575e-06,1.04497198798163e-05,1.11465816389515e-05,1.19000470968494e-05,1.27027354434882e-05,1.35609425091391e-05,1.44675996946526e-05,1.54297310328785e-05,1.64399359598089e-05,1.75060871750688e-05,1.86206787907097e-05,1.97918146402394e-05,2.10122968725222e-05,2.22903656780449e-05,2.36186470372501e-05,2.50060418408340e-05,2.64446983530477e-05,2.79441551650314e-05,2.94959311162666e-05,3.11105804072354e-05,3.27784298449675e-05,3.45114062108268e-05,3.62984292432080e-05,3.81534472485604e-05,4.00623702658263e-05,4.20432480746818e-05,4.40755609791247e-05,4.61811515552712e-05,4.83886538351093e-05,5.05315417773855e-05,5.28897040080235e-05,5.52802577002609e-05,5.77156981591854e-05,6.02034998758238e-05,6.27671301340167e-05,6.54078243454134e-05,6.81289072199101e-05,7.09250631460016e-05,7.37946907146241e-05,7.67350584696191e-05,7.97456021659232e-05,8.28272510904934e-05,8.59807952569498e-05,8.92088421727689e-05,9.25116270847400e-05,9.58920187079905e-05,9.93491004305136e-05,0.000102885293649320,0.000106498475727631,0.000110191339735094,0.000113960505349841,0.000117809111555295,0.000121733412423812,0.000125736562208711,0.000129814965573891,0.000133972006743437,0.000138203733258764,0.000142514070136218,0.000146898609968972,0.000151361706538000,0.000155898247278174,0.000160513313568714,0.000165200732023184,0.000169966322660889,0.000174802726874689,0.000179717235654858,0.000184699928180320,0.000189761121685953,0.000194887686750076,0.000200083578728546,0.000205371260792925,0.000210688527542803,0.000216098236849101,0.000221578017227368,0.000227118689902367,0.000232715374109685,0.000238374666715234,0.000244098000573029,0.000249884226205365,0.000255729393138902,0.000261629310801588,0.000267582185369197,0.000273585581313708,0.000279639831515746,0.000285742840663275,0.000291894687279057,0.000298091554013271,0.000304332614365148,0.000310613183833952,0.000316932384398119,0.000323285221081034,0.000329671979966004,0.000336087346486941,0.000342532103579257,0.000349000906742340,0.000355494062396742,0.000362006004039327,0.000368536785063976,0.000375080118865157,0.000381636076515990,0.000388197865370801,0.000394765838324840,0.000401332602565016,0.000407899197878904,0.000414457545740019,0.000421009313580620,0.000427545382528525,0.000434068935325838,0.000440568498481369,0.000447049400418756,0.000453500268691326,0.000459915646897464,0.000466310256676655,0.000472651008152998,0.000478951877033479,0.000485209942181005,0.000491417206340912,0.000497565329988000,0.000503651547046962,0.000509674854681825,0.000515631033430829,0.000521515507009870,0.000527321118156741,0.000533044358792286,0.000538679636794476,0.000544224798262173,0.000549674286036212,0.000555025509840421,0.000560271509835851,0.000565408992856494,0.000570430927210721,0.000575334639819624,0.000580113016766194,0.000584764517199911,0.000589281661647855,0.000593662732624875,0.000597900114147311,0.000601991417274604,0.000605928929199372,0.000609710447017824,0.000613328157996311,0.000616780283526537,0.000620058965434156,0.000623162960925591,0.000626083955128908,0.000628821256079502,0.000631365948681134,0.000633717870070965,0.000635866943386977,0.000637814698174745,0.000639549205895412,0.000641073110709925,0.000642377888354043,0.000643454586203706,0.000644312170946742,0.000644933475841592,0.000645316766150466,0.000645461956384737,0.000645364245376956,0.000645017351877087,0.000644415467615778,0.000643557325102766,0.000642438836562516,0.000641057385501039,0.000639406336427572,0.000637483255738149,0.000635282981524998,0.000632804427428520,0.000630042710734348,0.000626996738140543,0.000623660945757118,0.000620033845426270,0.000616110223026880,0.000611889728959175,0.000607367113399464,0.000602543065840155,0.000597412243639436,0.000591975044117674,0.000586226424311223,0.000580166588259891,0.000573790869140190,0.000567100189496258,0.000560090287053382,0.000552762698816850,0.000545113209618064,0.000537143949512013,0.000528850406209944,0.000520235372045698,0.000511294142040259,0.000502030573873740,0.000492439093250484,0.000482525667871103,0.000472283864967818,0.000461719434010466,0.000450831598090452,0.000439615900133019,0.000428081112650157,0.000416224461132730,0.000404044423486252,0.000391545232479915,0.000378728785618072,0.000365597052522136,0.000352149048672637,0.000338388994531800,0.000324318650951257,0.000309942949290857,0.000295262010136698,0.000280280264574412,0.000264998980659733,0.000249424025056773,0.000233557174278258,0.000217404592077239,0.000200968015283126,0.000184253446167825,0.000167263005216752,0.000150004241711319,0.000132479361062594,0.000114696856487737,9.66592553950695e-05,7.83747953375648e-05,5.98466408465377e-05,4.10832073261945e-05,2.20882075577158e-05,2.87087697428511e-06,-1.65645509139463e-05,-3.62082465194258e-05,-5.60559833479948e-05,-7.60973234093763e-05,-9.63281247815836e-05,-0.000116737114753882,-0.000137320104583833,-0.000158064349380509,-0.000178966526293059,-0.000200012023902992,-0.000221197509727537,-0.000242510220162025,-0.000263940425731291,-0.000285482754447588,-0.000307124247885778,-0.000328853946607017,-0.000350665236879636,-0.000372546315882224,-0.000394486812862025,-0.000416473981096384,-0.000438499950501898,-0.000460552176610008,-0.000482620927485250,-0.000504691979467486,-0.000526756245600703,-0.000548800495363563,-0.000570815164315339,-0.000592785708176042,-0.000614702000461866,-0.000636549311880622,-0.000658317345472435,-0.000679991581653070,-0.000701561942325737,-0.000723012516980061,-0.000744333327121409,-0.000765508056798136,-0.000786526380599751,-0.000807372514998138,-0.000828035654846129,-0.000848499892953553,-0.000868754121283740,-0.000888781971007900,-0.000908572121023797,-0.000928107920783495,-0.000947378391797083,-0.000966366620480289,-0.000985061926126460,-0.00100344683359678,-0.00102151103340378,-0.00103923576475671,-0.00105661200005715,-0.00107362013391215,-0.00109025053206995,-0.00110648694596315,-0.00112231416081989,-0.00113772020878865,-0.00115269109458300,-0.00116720958459068,-0.00118126423986593,-0.00119484001336966,-0.00120792416064279,-0.00122049974637631,-0.00123255540106188,-0.00124407585766678,-0.00125504966365449,-0.00126546013672522,-0.00127529576211691,-0.00128454121002324,-0.00129318562709914,-0.00130121312622891,-0.00130861268192014,-0.00131536891795672,-0.00132147105147267,-0.00132690416772830,-0.00133165867697760,-0.00133571888211430,-0.00133907562178096,-0.00134171360823394,-0.00134362366742675,-0.00134479161723013,-0.00134520845105002,-0.00134486039057164,-0.00134373877228514,-0.00134183011635262,-0.00133912624569253,-0.00133561399671620,-0.00133128608313978,-0.00132612967671058,-0.00132013831524755,-0.00131329912216762,-0.00130560677494195,-0.00129704764615716,-0.00128761811838262,-0.00127730514128901,-0.00126610417658404,-0.00125400652476025,-0.00124100405459222,-0.00122708978297071,-0.00121225922047517,-0.00119650264465661,-0.00117981580793808,-0.00116219176091994,-0.00114362754337219,-0.00112411508135651,-0.00110365173153851,-0.00108223131286164,-0.00105985270856937,-0.00103650948423345,-0.00101220023159609,-0.000986919903676812,-0.000960668833433860,-0.000933442437815683,-0.000905241220168976,-0.000876061709291493,-0.000845905203611416,-0.000814768674690523,-0.000782655368924181,-0.000749562190537951,-0.000715493021081902,-0.000680445915860819,-0.000644425108662350,-0.000607430204864205,-0.000569466186695484,-0.000530533482575691,-0.000490637818992935,-0.000449780396594173,-0.000407967884490655,-0.000365202159908978,-0.000321491059920151,-0.000276837157615950,-0.000231249502408106,-0.000184730903980292,-0.000137292103149930,-8.89355700943520e-05,-3.96736063563429e-05,1.04896568402763e-05,6.15432162542259e-05,0.000113478722321783,0.000166286704526404,0.000219959090812044,0.000274482579070758,0.000329849263099478,0.000386046574571062,0.000443064941909281,0.000500889386527337,0.000559510224493267,0.000618912851319667,0.000679086592048594,0.000740014856363447,0.000801686115310418,0.000864084168911842,0.000927196858020169,0.000991006134670514,0.00105549881296910,0.00112065692175226,0.00118646634657571,0.00125290809532936,0.00131996820456650,0.00138762573327864,0.00145586644855674,0.00152466913079187,0.00159401832924148,0.00166389269214447,0.00173427553094944,0.00180514489230831,0.00187648351594527,0.00194826902320823,0.00202048364053179,0.00209310425029174,0.00216611263813799,0.00223948487492673,0.00231320238781694,0.00238724028911424,0.00246158021716412,0.00253619584913875,0.00261106932146424,0.00268617382003626,0.00276148963653565,0.00283699188037216,0.00291265799395497,0.00298846331022838,0.00306438702086525,0.00314040225740322,0.00321648713309106,0.00329261576970325,0.00336876654750030,0.00344491199640237,0.00352102984321111,0.00359709341422160,0.00367308100461171,0.00374896498225213,0.00382472250883180,0.00390032648572545,0.00397575483296005,0.00405097971445803,0.00412597813321208,0.00420072306839442,0.00427519168694063,0.00434935618080725,0.00442319496604239,0.00449667921196961,0.00456978733676843,0.00464249123084161,0.00471476880921560,0.00478659266336677,0.00485794045821879,0.00492878496814409,0.00499910405301415,0.00506887089773140,0.00513806367877676,0.00520665562122300,0.00527462522857362,0.00534194581890310,0.00540859651704568,0.00547455051238261,0.00553978814378401,0.00560428207374323,0.00566801359322211,0.00573095640384614,0.00579309049405398,0.00585439206018678,0.00591484025394018,0.00597441108716134,0.00603308627710681,0.00609084200976388,0.00614765916507138,0.00620351479951972,0.00625839164994843,0.00631226705292246,0.00636512344200162,0.00641693899065490,0.00646769790315881,0.00651737916870579,0.00656596642851692,0.00661343917425673,0.00665978297683290,0.00670497834293205,0.00674901037842909,0.00679186092871650,0.00683351668860883,0.00687395900873676,0.00691317674568684,0.00695115147937797,0.00698787245976042,0.00702332296972364,0.00705749258387408,0.00709036605571955,0.00712193364251464,0.00715218104168030,0.00718109936560569,0.00720867543822059,0.00723490145963935,0.00725976504861869,0.00728325941009969,0.00730537298318559,0.00732610043807722,0.00734543071674431,0.00736336040757778,0.00737987871558235,0.00739498322152873,0.00740866526234004,0.00742092175346825,0.00743174651926840,0.00744113729704265,0.00744908770083145,0.00745559781821279,0.00746066310658006,0.00746428364197298,0.00746645518370831,0.00746717987443036,0.00746645518370831,0.00746428364197298,0.00746066310658006,0.00745559781821279,0.00744908770083145,0.00744113729704265,0.00743174651926840,0.00742092175346825,0.00740866526234004,0.00739498322152873,0.00737987871558235,0.00736336040757778,0.00734543071674431,0.00732610043807722,0.00730537298318559,0.00728325941009969,0.00725976504861869,0.00723490145963935,0.00720867543822059,0.00718109936560569,0.00715218104168030,0.00712193364251464,0.00709036605571955,0.00705749258387408,0.00702332296972364,0.00698787245976042,0.00695115147937797,0.00691317674568684,0.00687395900873676,0.00683351668860883,0.00679186092871650,0.00674901037842909,0.00670497834293205,0.00665978297683290,0.00661343917425673,0.00656596642851692,0.00651737916870579,0.00646769790315881,0.00641693899065490,0.00636512344200162,0.00631226705292246,0.00625839164994843,0.00620351479951972,0.00614765916507138,0.00609084200976388,0.00603308627710681,0.00597441108716134,0.00591484025394018,0.00585439206018678,0.00579309049405398,0.00573095640384614,0.00566801359322211,0.00560428207374323,0.00553978814378401,0.00547455051238261,0.00540859651704568,0.00534194581890310,0.00527462522857362,0.00520665562122300,0.00513806367877676,0.00506887089773140,0.00499910405301415,0.00492878496814409,0.00485794045821879,0.00478659266336677,0.00471476880921560,0.00464249123084161,0.00456978733676843,0.00449667921196961,0.00442319496604239,0.00434935618080725,0.00427519168694063,0.00420072306839442,0.00412597813321208,0.00405097971445803,0.00397575483296005,0.00390032648572545,0.00382472250883180,0.00374896498225213,0.00367308100461171,0.00359709341422160,0.00352102984321111,0.00344491199640237,0.00336876654750030,0.00329261576970325,0.00321648713309106,0.00314040225740322,0.00306438702086525,0.00298846331022838,0.00291265799395497,0.00283699188037216,0.00276148963653565,0.00268617382003626,0.00261106932146424,0.00253619584913875,0.00246158021716412,0.00238724028911424,0.00231320238781694,0.00223948487492673,0.00216611263813799,0.00209310425029174,0.00202048364053179,0.00194826902320823,0.00187648351594527,0.00180514489230831,0.00173427553094944,0.00166389269214447,0.00159401832924148,0.00152466913079187,0.00145586644855674,0.00138762573327864,0.00131996820456650,0.00125290809532936,0.00118646634657571,0.00112065692175226,0.00105549881296910,0.000991006134670514,0.000927196858020169,0.000864084168911842,0.000801686115310418,0.000740014856363447,0.000679086592048594,0.000618912851319667,0.000559510224493267,0.000500889386527337,0.000443064941909281,0.000386046574571062,0.000329849263099478,0.000274482579070758,0.000219959090812044,0.000166286704526404,0.000113478722321783,6.15432162542259e-05,1.04896568402763e-05,-3.96736063563429e-05,-8.89355700943520e-05,-0.000137292103149930,-0.000184730903980292,-0.000231249502408106,-0.000276837157615950,-0.000321491059920151,-0.000365202159908978,-0.000407967884490655,-0.000449780396594173,-0.000490637818992935,-0.000530533482575691,-0.000569466186695484,-0.000607430204864205,-0.000644425108662350,-0.000680445915860819,-0.000715493021081902,-0.000749562190537951,-0.000782655368924181,-0.000814768674690523,-0.000845905203611416,-0.000876061709291493,-0.000905241220168976,-0.000933442437815683,-0.000960668833433860,-0.000986919903676812,-0.00101220023159609,-0.00103650948423345,-0.00105985270856937,-0.00108223131286164,-0.00110365173153851,-0.00112411508135651,-0.00114362754337219,-0.00116219176091994,-0.00117981580793808,-0.00119650264465661,-0.00121225922047517,-0.00122708978297071,-0.00124100405459222,-0.00125400652476025,-0.00126610417658404,-0.00127730514128901,-0.00128761811838262,-0.00129704764615716,-0.00130560677494195,-0.00131329912216762,-0.00132013831524755,-0.00132612967671058,-0.00133128608313978,-0.00133561399671620,-0.00133912624569253,-0.00134183011635262,-0.00134373877228514,-0.00134486039057164,-0.00134520845105002,-0.00134479161723013,-0.00134362366742675,-0.00134171360823394,-0.00133907562178096,-0.00133571888211430,-0.00133165867697760,-0.00132690416772830,-0.00132147105147267,-0.00131536891795672,-0.00130861268192014,-0.00130121312622891,-0.00129318562709914,-0.00128454121002324,-0.00127529576211691,-0.00126546013672522,-0.00125504966365449,-0.00124407585766678,-0.00123255540106188,-0.00122049974637631,-0.00120792416064279,-0.00119484001336966,-0.00118126423986593,-0.00116720958459068,-0.00115269109458300,-0.00113772020878865,-0.00112231416081989,-0.00110648694596315,-0.00109025053206995,-0.00107362013391215,-0.00105661200005715,-0.00103923576475671,-0.00102151103340378,-0.00100344683359678,-0.000985061926126460,-0.000966366620480289,-0.000947378391797083,-0.000928107920783495,-0.000908572121023797,-0.000888781971007900,-0.000868754121283740,-0.000848499892953553,-0.000828035654846129,-0.000807372514998138,-0.000786526380599751,-0.000765508056798136,-0.000744333327121409,-0.000723012516980061,-0.000701561942325737,-0.000679991581653070,-0.000658317345472435,-0.000636549311880622,-0.000614702000461866,-0.000592785708176042,-0.000570815164315339,-0.000548800495363563,-0.000526756245600703,-0.000504691979467486,-0.000482620927485250,-0.000460552176610008,-0.000438499950501898,-0.000416473981096384,-0.000394486812862025,-0.000372546315882224,-0.000350665236879636,-0.000328853946607017,-0.000307124247885778,-0.000285482754447588,-0.000263940425731291,-0.000242510220162025,-0.000221197509727537,-0.000200012023902992,-0.000178966526293059,-0.000158064349380509,-0.000137320104583833,-0.000116737114753882,-9.63281247815836e-05,-7.60973234093763e-05,-5.60559833479948e-05,-3.62082465194258e-05,-1.65645509139463e-05,2.87087697428511e-06,2.20882075577158e-05,4.10832073261945e-05,5.98466408465377e-05,7.83747953375648e-05,9.66592553950695e-05,0.000114696856487737,0.000132479361062594,0.000150004241711319,0.000167263005216752,0.000184253446167825,0.000200968015283126,0.000217404592077239,0.000233557174278258,0.000249424025056773,0.000264998980659733,0.000280280264574412,0.000295262010136698,0.000309942949290857,0.000324318650951257,0.000338388994531800,0.000352149048672637,0.000365597052522136,0.000378728785618072,0.000391545232479915,0.000404044423486252,0.000416224461132730,0.000428081112650157,0.000439615900133019,0.000450831598090452,0.000461719434010466,0.000472283864967818,0.000482525667871103,0.000492439093250484,0.000502030573873740,0.000511294142040259,0.000520235372045698,0.000528850406209944,0.000537143949512013,0.000545113209618064,0.000552762698816850,0.000560090287053382,0.000567100189496258,0.000573790869140190,0.000580166588259891,0.000586226424311223,0.000591975044117674,0.000597412243639436,0.000602543065840155,0.000607367113399464,0.000611889728959175,0.000616110223026880,0.000620033845426270,0.000623660945757118,0.000626996738140543,0.000630042710734348,0.000632804427428520,0.000635282981524998,0.000637483255738149,0.000639406336427572,0.000641057385501039,0.000642438836562516,0.000643557325102766,0.000644415467615778,0.000645017351877087,0.000645364245376956,0.000645461956384737,0.000645316766150466,0.000644933475841592,0.000644312170946742,0.000643454586203706,0.000642377888354043,0.000641073110709925,0.000639549205895412,0.000637814698174745,0.000635866943386977,0.000633717870070965,0.000631365948681134,0.000628821256079502,0.000626083955128908,0.000623162960925591,0.000620058965434156,0.000616780283526537,0.000613328157996311,0.000609710447017824,0.000605928929199372,0.000601991417274604,0.000597900114147311,0.000593662732624875,0.000589281661647855,0.000584764517199911,0.000580113016766194,0.000575334639819624,0.000570430927210721,0.000565408992856494,0.000560271509835851,0.000555025509840421,0.000549674286036212,0.000544224798262173,0.000538679636794476,0.000533044358792286,0.000527321118156741,0.000521515507009870,0.000515631033430829,0.000509674854681825,0.000503651547046962,0.000497565329988000,0.000491417206340912,0.000485209942181005,0.000478951877033479,0.000472651008152998,0.000466310256676655,0.000459915646897464,0.000453500268691326,0.000447049400418756,0.000440568498481369,0.000434068935325838,0.000427545382528525,0.000421009313580620,0.000414457545740019,0.000407899197878904,0.000401332602565016,0.000394765838324840,0.000388197865370801,0.000381636076515990,0.000375080118865157,0.000368536785063976,0.000362006004039327,0.000355494062396742,0.000349000906742340,0.000342532103579257,0.000336087346486941,0.000329671979966004,0.000323285221081034,0.000316932384398119,0.000310613183833952,0.000304332614365148,0.000298091554013271,0.000291894687279057,0.000285742840663275,0.000279639831515746,0.000273585581313708,0.000267582185369197,0.000261629310801588,0.000255729393138902,0.000249884226205365,0.000244098000573029,0.000238374666715234,0.000232715374109685,0.000227118689902367,0.000221578017227368,0.000216098236849101,0.000210688527542803,0.000205371260792925,0.000200083578728546,0.000194887686750076,0.000189761121685953,0.000184699928180320,0.000179717235654858,0.000174802726874689,0.000169966322660889,0.000165200732023184,0.000160513313568714,0.000155898247278174,0.000151361706538000,0.000146898609968972,0.000142514070136218,0.000138203733258764,0.000133972006743437,0.000129814965573891,0.000125736562208711,0.000121733412423812,0.000117809111555295,0.000113960505349841,0.000110191339735094,0.000106498475727631,0.000102885293649320,9.93491004305136e-05,9.58920187079905e-05,9.25116270847400e-05,8.92088421727689e-05,8.59807952569498e-05,8.28272510904934e-05,7.97456021659232e-05,7.67350584696191e-05,7.37946907146241e-05,7.09250631460016e-05,6.81289072199101e-05,6.54078243454134e-05,6.27671301340167e-05,6.02034998758238e-05,5.77156981591854e-05,5.52802577002609e-05,5.28897040080235e-05,5.05315417773855e-05,4.83886538351093e-05,4.61811515552712e-05,4.40755609791247e-05,4.20432480746818e-05,4.00623702658263e-05,3.81534472485604e-05,3.62984292432080e-05,3.45114062108268e-05,3.27784298449675e-05,3.11105804072354e-05,2.94959311162666e-05,2.79441551650314e-05,2.64446983530477e-05,2.50060418408340e-05,2.36186470372501e-05,2.22903656780449e-05,2.10122968725222e-05,1.97918146402394e-05,1.86206787907097e-05,1.75060871750688e-05,1.64399359598089e-05,1.54297310328785e-05,1.44675996946526e-05,1.35609425091391e-05,1.27027354434882e-05,1.19000470968494e-05,1.11465816389515e-05,1.04497198798163e-05,9.80363095383575e-06,9.21608429213179e-06,8.68199871150619e-06,8.20975196229050e-06,7.79489228738381e-06,7.44679735310842e-06,7.16212748291280e-06,6.95114550358716e-06,6.81164408343599e-06,6.75548742340925e-06,6.78233193872101e-06,6.90567082957985e-06,7.12716703474689e-06,-6.73258239445068e-05];
am_sc_out = filter(Num_filter,1,y_am);
figure(5)
plot(am_sc_out)
pwelch(am_sc_out,[],[],2^12,fs,'centered','power');


% % 
% % 2*fm*(1+kf/fm*max(abs(m_sig)))